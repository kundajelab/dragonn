

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dragonn.synthetic.util &mdash; DragoNN 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="DragoNN 0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> DragoNN</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dragonn.html">dragonn package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dragonn.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dragonn.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dragonn.html#module-dragonn">Module contents</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">DragoNN</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>dragonn.synthetic.util</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for dragonn.synthetic.util</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>


<span class="k">def</span> <span class="nf">enum</span><span class="p">(</span><span class="o">**</span><span class="n">enums</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Enum</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">Enum</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">enums</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">toReturn</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">toReturn</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">toReturn</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">enums</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">toReturn</span><span class="o">.</span><span class="n">theDict</span> <span class="o">=</span> <span class="n">enums</span>
    <span class="k">return</span> <span class="n">toReturn</span>


<span class="k">def</span> <span class="nf">normaliseEntriesByMeanAndSdev</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c">#assert np.mean(arr)==0 or np.mean(arr) &lt; 10**(-7), np.mean(arr)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">normaliseEntriesBySdev</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">normaliseRowsByMeanAndSdev_firstFourSeq</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="c"># normalises each row by mean and sdev but</span>
    <span class="c"># treats the first four as one track type</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">])]</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">sdevs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">])]</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">means</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sdevs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sdevs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sdevs</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sdevs</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">normaliseEntriesZeroToOne</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">minArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">minArr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="n">minArr</span><span class="p">)</span>


<div class="viewcode-block" id="divideByPerPositionRange"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.divideByPerPositionRange">[docs]</a><span class="k">def</span> <span class="nf">divideByPerPositionRange</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span>
    <span class="n">perPositionRange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">perPositionRange</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">normaliseEntriesByMeanAndTwoNorm</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">theMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">theMean</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">theMean</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">runningWindowOneOver</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="n">runningWindowVals</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)</span>
    <span class="n">runningWindowVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">fix_invalid</span><span class="p">(</span><span class="n">runningWindowVals</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">toMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">runningWindowVals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">runningWindowVals</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">toMask</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">computeRunningWindowOneOverTwoNorm_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">runningWindowOneOver</span><span class="p">(</span><span class="n">computeRunningWindowTwoNorm_2d</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">computeRunningWindowOneOverMaxActivation_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">runningWindowOneOver</span><span class="p">(</span><span class="n">computeRunningWindowMaxActivation_2d</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">computeRunningWindowSum_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">computeRunningWindowSum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">windowSize</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">crossCorrelation_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">reversedSmaller</span> <span class="o">=</span> <span class="n">smallerArr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">crossCorrelations</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">reversedSmaller</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crossCorrelations</span>

<span class="n">CROSSC_NORMFUNC</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="n">meanAndSdev</span><span class="o">=</span><span class="n">normaliseEntriesByMeanAndSdev</span><span class="p">,</span> <span class="n">meanAndTwoNorm</span><span class="o">=</span><span class="n">normaliseEntriesByMeanAndTwoNorm</span><span class="p">,</span> <span class="n">sdev</span><span class="o">=</span><span class="n">normaliseEntriesBySdev</span><span class="p">,</span>
                       <span class="n">meanAndSdev_byRow_firstFourSeq</span><span class="o">=</span><span class="n">normaliseRowsByMeanAndSdev_firstFourSeq</span><span class="p">,</span> <span class="n">none</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">zeroToOne</span><span class="o">=</span><span class="n">normaliseEntriesZeroToOne</span><span class="p">,</span> <span class="n">perPositionRange</span><span class="o">=</span><span class="n">divideByPerPositionRange</span><span class="p">)</span>
<span class="n">PERPOS_NORMFUNC</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="n">oneOverTwoNorm</span><span class="o">=</span><span class="n">computeRunningWindowOneOverTwoNorm_2d</span><span class="p">,</span> <span class="n">oneOverMaxAct</span><span class="o">=</span><span class="n">computeRunningWindowOneOverMaxActivation_2d</span><span class="p">,</span>
                       <span class="n">theSum</span><span class="o">=</span><span class="n">computeRunningWindowSum_2d</span><span class="p">,</span> <span class="n">crossCorrelate</span><span class="o">=</span><span class="n">crossCorrelation_2d</span><span class="p">)</span>


<div class="viewcode-block" id="crossCorrelateArraysLengthwise"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.crossCorrelateArraysLengthwise">[docs]</a><span class="k">def</span> <span class="nf">crossCorrelateArraysLengthwise</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">,</span> <span class="n">normaliseFunc</span><span class="p">,</span> <span class="n">smallerPerPosNormFuncs</span><span class="o">=</span><span class="p">[],</span> <span class="n">largerPerPosNormFuncs</span><span class="o">=</span><span class="p">[],</span> <span class="n">auxLargerForPerPosNorm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">auxLargerPerPosNormFuncs</span><span class="o">=</span><span class="p">[],</span> <span class="n">pad</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">auxLargerPerPosNormFuncs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">auxLargerForPerPosNorm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;arr must be 2d...did you use np.squeeze to get rid of 1-d axes? arr dims are: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;arr must be 2d...did you use np.squeeze to get rid of 1-d axes? arr dims are: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c"># is a lengthwise correlation</span>
    <span class="k">assert</span> <span class="n">arr1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">arr2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">normArr1</span> <span class="o">=</span> <span class="n">normaliseFunc</span><span class="p">(</span><span class="n">arr1</span><span class="p">)</span>
    <span class="n">normArr2</span> <span class="o">=</span> <span class="n">normaliseFunc</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
    <span class="c"># determine larger one</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">normArr1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">normArr2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">smaller</span> <span class="o">=</span> <span class="n">normArr2</span>
        <span class="n">larger</span> <span class="o">=</span> <span class="n">normArr1</span>
        <span class="n">firstIsSmaller</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">smaller</span> <span class="o">=</span> <span class="n">normArr1</span>
        <span class="n">larger</span> <span class="o">=</span> <span class="n">normArr2</span>
        <span class="n">firstIsSmaller</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">normalisedSmaller</span> <span class="o">=</span> <span class="n">smaller</span>
    <span class="k">for</span> <span class="n">perPosNormFunc</span> <span class="ow">in</span> <span class="n">smallerPerPosNormFuncs</span><span class="p">:</span>
        <span class="n">normalisedSmaller</span> <span class="o">=</span> <span class="n">normalisedSmaller</span> <span class="o">*</span> <span class="n">perPosNormFunc</span><span class="p">(</span>
            <span class="n">arr</span><span class="o">=</span><span class="n">smaller</span><span class="p">,</span> <span class="n">smallerArr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">windowSize</span><span class="o">=</span><span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">smaller</span> <span class="o">=</span> <span class="n">normalisedSmaller</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pad</span><span class="p">):</span>
        <span class="c"># pad the larger one</span>
        <span class="n">pad_width</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">[</span><span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;constant&#39;</span>
        <span class="n">paddedLarger</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">larger</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="n">pad_width</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">auxLargerForPerPosNorm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">auxLargerForPerPosNorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">auxLargerForPerPosNorm</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="n">pad_width</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paddedLarger</span> <span class="o">=</span> <span class="n">larger</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">auxLargerForPerPosNorm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">auxLargerForPerPosNorm</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">paddedLarger</span><span class="o">.</span><span class="n">shape</span>\
            <span class="p">,</span> <span class="p">(</span><span class="n">paddedLarger</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">auxLargerForPerPosNorm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">reversedSmaller</span> <span class="o">=</span> <span class="n">smaller</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">crossCorrelations</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span>
        <span class="n">paddedLarger</span><span class="p">,</span> <span class="n">reversedSmaller</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">perPosNormFunc</span> <span class="ow">in</span> <span class="n">largerPerPosNormFuncs</span><span class="p">:</span>
        <span class="n">crossCorrelations</span> <span class="o">*=</span> <span class="n">perPosNormFunc</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="n">paddedLarger</span><span class="p">,</span>
                                            <span class="n">smallerArr</span><span class="o">=</span><span class="n">smaller</span><span class="p">,</span> <span class="n">windowSize</span><span class="o">=</span><span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">perPosNormFunc</span> <span class="ow">in</span> <span class="n">auxLargerPerPosNormFuncs</span><span class="p">:</span>
        <span class="n">normVals</span> <span class="o">=</span> <span class="n">perPosNormFunc</span><span class="p">(</span>
            <span class="n">arr</span><span class="o">=</span><span class="n">auxLargerForPerPosNorm</span><span class="p">,</span> <span class="n">smallerArr</span><span class="o">=</span><span class="n">smaller</span><span class="p">,</span> <span class="n">windowSize</span><span class="o">=</span><span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">normVals</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">,</span> <span class="p">(</span><span class="n">auxLargerForPerPosNorm</span><span class="p">,</span> <span class="n">normVals</span><span class="p">,</span> <span class="n">perPosNormFunc</span><span class="p">)</span>
        <span class="n">crossCorrelations</span> <span class="o">*=</span> <span class="n">normVals</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pad</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">crossCorrelations</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">larger</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">crossCorrelations</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">larger</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c"># the len of the smaller array will be used to calculate index</span>
    <span class="c"># shifts when you do somethign like find the point of the max</span>
    <span class="c"># cross correlation</span>
    <span class="c"># also it&#39;s crossCorrelations[0] because we are only interested in the</span>
    <span class="c"># lengthwise cross correlations; first dim has size 1.</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">crossCorrelations</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">==</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">crossCorrelations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">firstIsSmaller</span><span class="p">,</span> <span class="n">smaller</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="getBestLengthwiseCrossCorrelationOfArrays"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getBestLengthwiseCrossCorrelationOfArrays">[docs]</a><span class="k">def</span> <span class="nf">getBestLengthwiseCrossCorrelationOfArrays</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">,</span> <span class="n">normaliseFunc</span><span class="p">,</span> <span class="n">smallerPerPosNormFuncs</span><span class="p">,</span> <span class="n">largerPerPosNormFuncs</span><span class="p">):</span>
    <span class="n">crossCorrelations</span><span class="p">,</span> <span class="n">firstIsSmaller</span><span class="p">,</span> <span class="n">smallerLen</span> <span class="o">=</span> <span class="n">crossCorrelateArraysLengthwise</span><span class="p">(</span>
        <span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">,</span> <span class="n">normaliseFunc</span><span class="o">=</span><span class="n">normaliseFunc</span><span class="p">,</span> <span class="n">smallerPerPosNormFuncs</span><span class="o">=</span><span class="n">smallerPerPosNormFuncs</span><span class="p">,</span> <span class="n">largerPerPosNormFuncs</span><span class="o">=</span><span class="n">largerPerPosNormFuncs</span><span class="p">)</span>
    <span class="n">correlationIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">crossCorrelations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crossCorrelations</span><span class="p">[</span><span class="n">correlationIdx</span><span class="p">]</span>\
        <span class="p">,</span> <span class="p">(</span><span class="n">correlationIdx</span> <span class="o">-</span> <span class="p">(</span><span class="n">smallerLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>\
        <span class="p">,</span> <span class="n">firstIsSmaller</span>

</div>
<div class="viewcode-block" id="isNumpy"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.isNumpy">[docs]</a><span class="k">def</span> <span class="nf">isNumpy</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="c"># return true if the object is a numpy object</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">__name__</span>

</div>
<div class="viewcode-block" id="npArrayIfList"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.npArrayIfList">[docs]</a><span class="k">def</span> <span class="nf">npArrayIfList</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="c"># cast something to a numpy array if it&#39;s a list,</span>
    <span class="c"># otherwise just return the original object.</span>
    <span class="c"># this is to avoid making an unnecessary copy</span>
    <span class="c"># if something is already a numpy array.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isNumpy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">arr</span>
</div>
<span class="n">ArgsAndKwargs</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;ArgsAndKwargs&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;args&quot;</span><span class="p">,</span> <span class="s">&quot;kwargs&quot;</span><span class="p">])</span>

<span class="n">DEFAULT_LETTER_ORDERING</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">]</span>
<span class="n">DEFAULT_BACKGROUND_FREQ</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
    <span class="p">[(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">)])</span>


<div class="viewcode-block" id="DiscreteDistribution"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.DiscreteDistribution">[docs]</a><span class="k">class</span> <span class="nc">DiscreteDistribution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valToFreq</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            valToFreq: OrderedDict where the keys are the possible things to sample, and the values are their frequencies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valToFreq</span> <span class="o">=</span> <span class="n">valToFreq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqArr</span> <span class="o">=</span> <span class="n">valToFreq</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>  <span class="c"># array representing only the probabilities</span>
        <span class="c"># map from index in freqArr to the corresponding value it represents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexToVal</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                               <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">valToFreq</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>
<span class="n">DEFAULT_BASE_DISCRETE_DISTRIBUTION</span> <span class="o">=</span> <span class="n">DiscreteDistribution</span><span class="p">(</span>
    <span class="n">DEFAULT_BACKGROUND_FREQ</span><span class="p">)</span>


<div class="viewcode-block" id="GetBest"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest">[docs]</a><span class="k">class</span> <span class="nc">GetBest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bestObject</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bestVal</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="GetBest.process"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theObject</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">replace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestObject</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isBetter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">replace</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bestObject</span> <span class="o">=</span> <span class="n">theObject</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bestVal</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">replace</span>
</div>
<div class="viewcode-block" id="GetBest.isBetter"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest.isBetter">[docs]</a>    <span class="k">def</span> <span class="nf">isBetter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GetBest.getBest"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest.getBest">[docs]</a>    <span class="k">def</span> <span class="nf">getBest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestVal</span>
</div>
<div class="viewcode-block" id="GetBest.getBestVal"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest.getBestVal">[docs]</a>    <span class="k">def</span> <span class="nf">getBestVal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestVal</span>
</div>
<div class="viewcode-block" id="GetBest.getBestObj"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest.getBestObj">[docs]</a>    <span class="k">def</span> <span class="nf">getBestObj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestObject</span>

</div></div>
<div class="viewcode-block" id="GetBest_Max"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest_Max">[docs]</a><span class="k">class</span> <span class="nc">GetBest_Max</span><span class="p">(</span><span class="n">GetBest</span><span class="p">):</span>

<div class="viewcode-block" id="GetBest_Max.isBetter"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest_Max.isBetter">[docs]</a>    <span class="k">def</span> <span class="nf">isBetter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestVal</span>

</div></div>
<div class="viewcode-block" id="GetBest_Min"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest_Min">[docs]</a><span class="k">class</span> <span class="nc">GetBest_Min</span><span class="p">(</span><span class="n">GetBest</span><span class="p">):</span>

<div class="viewcode-block" id="GetBest_Min.isBetter"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.GetBest_Min.isBetter">[docs]</a>    <span class="k">def</span> <span class="nf">isBetter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bestVal</span>

</div></div>
<div class="viewcode-block" id="isBetter"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.isBetter">[docs]</a><span class="k">def</span> <span class="nf">isBetter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">referenceValue</span><span class="p">,</span> <span class="n">isLargerBetter</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isLargerBetter</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">referenceValue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">referenceValue</span>

</div>
<div class="viewcode-block" id="isBetterOrEqual"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.isBetterOrEqual">[docs]</a><span class="k">def</span> <span class="nf">isBetterOrEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">referenceValue</span><span class="p">,</span> <span class="n">isLargerBetter</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isLargerBetter</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">referenceValue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">referenceValue</span>

</div>
<div class="viewcode-block" id="addDictionary"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.addDictionary">[docs]</a><span class="k">def</span> <span class="nf">addDictionary</span><span class="p">(</span><span class="n">toUpdate</span><span class="p">,</span> <span class="n">toAdd</span><span class="p">,</span> <span class="n">initVal</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mergeFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defaults to addition, technically applicable any time you want to</span>
<span class="sd">        update a dictionary (toUpdate) with the entries of another dictionary</span>
<span class="sd">        (toAdd) using a particular operation (eg: adding corresponding keys)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">toAdd</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">toUpdate</span><span class="p">:</span>
            <span class="n">toUpdate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">initVal</span>
        <span class="n">toUpdate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergeFunc</span><span class="p">(</span><span class="n">toUpdate</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">toAdd</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="getExtremeN"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getExtremeN">[docs]</a><span class="k">def</span> <span class="nf">getExtremeN</span><span class="p">(</span><span class="n">toSort</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">keyFunc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">enumeratedToSort</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">toSort</span><span class="p">)]</span>
    <span class="n">sortedVals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">enumeratedToSort</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">keyFunc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sortedVals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">]]</span>

</div>
<span class="n">reverseComplementLookup</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span> <span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">:</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">:</span> <span class="s">&#39;G&#39;</span><span class="p">,</span>
                           <span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">:</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">:</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="s">&#39;n&#39;</span><span class="p">}</span>


<div class="viewcode-block" id="reverseComplement"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.reverseComplement">[docs]</a><span class="k">def</span> <span class="nf">reverseComplement</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
    <span class="n">reversedSequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">reverseComplemented</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">reverseComplementLookup</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reversedSequence</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reverseComplemented</span>

</div>
<div class="viewcode-block" id="executeAsSystemCall"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.executeAsSystemCall">[docs]</a><span class="k">def</span> <span class="nf">executeAsSystemCall</span><span class="p">(</span><span class="n">commandToExecute</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Executing: &quot;</span> <span class="o">+</span> <span class="n">commandToExecute</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">commandToExecute</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error encountered with command &quot;</span> <span class="o">+</span> <span class="n">commandToExecute</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="executeForAllFilesInDirectory"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.executeForAllFilesInDirectory">[docs]</a><span class="k">def</span> <span class="nf">executeForAllFilesInDirectory</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">fileFilterFunction</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">filesInDirectory</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s">&quot;/*&quot;</span><span class="p">)</span>
    <span class="n">filesInDirectory</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">aFile</span> <span class="k">for</span> <span class="n">aFile</span> <span class="ow">in</span> <span class="n">filesInDirectory</span> <span class="k">if</span> <span class="n">fileFilterFunction</span><span class="p">(</span><span class="n">aFile</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">aFile</span> <span class="ow">in</span> <span class="n">filesInDirectory</span><span class="p">:</span>
        <span class="n">function</span><span class="p">(</span><span class="n">aFile</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="enum"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.enum">[docs]</a><span class="k">def</span> <span class="nf">enum</span><span class="p">(</span><span class="o">**</span><span class="n">enums</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Enum</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">Enum</span>  <span class="c"># type(&#39;Enum&#39;, (), {})</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">enums</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">toReturn</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">toReturn</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">toReturn</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">enums</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">toReturn</span><span class="o">.</span><span class="n">theDict</span> <span class="o">=</span> <span class="n">enums</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="combineEnums"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.combineEnums">[docs]</a><span class="k">def</span> <span class="nf">combineEnums</span><span class="p">(</span><span class="o">*</span><span class="n">enums</span><span class="p">):</span>
    <span class="n">newEnumDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">anEnum</span> <span class="ow">in</span> <span class="n">enums</span><span class="p">:</span>
        <span class="n">newEnumDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">anEnum</span><span class="o">.</span><span class="n">theDict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enum</span><span class="p">(</span><span class="o">**</span><span class="n">newEnumDict</span><span class="p">)</span>
</div>
<span class="n">SplitNames</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="s">&quot;train&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="s">&quot;valid&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="o">=</span><span class="s">&quot;eval&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="getTempDir"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getTempDir">[docs]</a><span class="k">def</span> <span class="nf">getTempDir</span><span class="p">():</span>
    <span class="n">tempOutputDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;TMP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tempOutputDir</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">tempOutputDir</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span>
            <span class="s">&quot;Please set the TMP environment variable to the temp output directory!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tempOutputDir</span>

<span class="c"># randomly shuffles the input arrays (correspondingly)</span>
<span class="c"># mutates arrs!</span>

</div>
<div class="viewcode-block" id="shuffleArray"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.shuffleArray">[docs]</a><span class="k">def</span> <span class="nf">shuffleArray</span><span class="p">(</span><span class="o">*</span><span class="n">arrs</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;should supply at least one input array&quot;</span><span class="p">)</span>
    <span class="n">lenOfArrs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c"># sanity check that all lengths are equal</span>
    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">lenOfArrs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First supplied array had length &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lenOfArrs</span><span class="p">)</span> <span class="o">+</span>
                             <span class="s">&quot; but a subsequent array had length &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lenOfArrs</span><span class="p">):</span>
        <span class="c"># randomly select index:</span>
        <span class="n">chosenIndex</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lenOfArrs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">:</span>
            <span class="n">valAtIndex</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">chosenIndex</span><span class="p">]</span>
            <span class="c"># swap</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">chosenIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">valAtIndex</span>
    <span class="k">return</span> <span class="n">arrs</span>

</div>
<div class="viewcode-block" id="sampleWithoutReplacement"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sampleWithoutReplacement">[docs]</a><span class="k">def</span> <span class="nf">sampleWithoutReplacement</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">numToSample</span><span class="p">):</span>
    <span class="n">arrayCopy</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numToSample</span><span class="p">):</span>
        <span class="n">randomIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrayCopy</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">swapIndices</span><span class="p">(</span><span class="n">arrayCopy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">randomIndex</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arrayCopy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numToSample</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="chainFunctions"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.chainFunctions">[docs]</a><span class="k">def</span> <span class="nf">chainFunctions</span><span class="p">(</span><span class="o">*</span><span class="n">functions</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s">&quot;input to chainFunctions should have at least two arguments&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chainedFunctions</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">chainedFunctions</span>

</div>
<div class="viewcode-block" id="parseJsonFile"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.parseJsonFile">[docs]</a><span class="k">def</span> <span class="nf">parseJsonFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="n">fileHandle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">)</span>
    <span class="n">fileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>

</div>
<div class="viewcode-block" id="parseYamlFile"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.parseYamlFile">[docs]</a><span class="k">def</span> <span class="nf">parseYamlFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="n">fileHandle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parseYamlFileHandle</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="parseYamlFileHandle"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.parseYamlFileHandle">[docs]</a><span class="k">def</span> <span class="nf">parseYamlFileHandle</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">)</span>
    <span class="n">fileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>

</div>
<div class="viewcode-block" id="parseMultipleYamlFiles"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.parseMultipleYamlFiles">[docs]</a><span class="k">def</span> <span class="nf">parseMultipleYamlFiles</span><span class="p">(</span><span class="n">pathsToYaml</span><span class="p">):</span>
    <span class="n">parsedYaml</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">pathToYaml</span> <span class="ow">in</span> <span class="n">pathsToYaml</span><span class="p">:</span>
        <span class="n">parsedYaml</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parseYamlFile</span><span class="p">(</span><span class="n">pathToYaml</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">parsedYaml</span>

</div>
<div class="viewcode-block" id="checkForAttributes"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.checkForAttributes">[docs]</a><span class="k">def</span> <span class="nf">checkForAttributes</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">attributesToCheckFor</span><span class="p">,</span> <span class="n">itemName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attributeToCheckFor</span> <span class="ow">in</span> <span class="n">attributesToCheckFor</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">attributeToCheckFor</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;supplied item &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="k">if</span> <span class="n">itemName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">itemName</span><span class="p">)</span> <span class="o">+</span>
                            <span class="s">&quot; should have attribute &quot;</span> <span class="o">+</span> <span class="n">attributeToCheckFor</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="transformType"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.transformType">[docs]</a><span class="k">def</span> <span class="nf">transformType</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">theType</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">theType</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">theType</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">theType</span> <span class="o">==</span> <span class="s">&quot;str&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unrecognised type &quot;</span> <span class="o">+</span> <span class="n">theType</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Entity"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Entity">[docs]</a><span class="k">class</span> <span class="nc">Entity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">}</span>

<div class="viewcode-block" id="Entity.addAttribute"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Entity.addAttribute">[docs]</a>    <span class="k">def</span> <span class="nf">addAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributeName</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">attributeName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">attributeName</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Attribute &quot;</span> <span class="o">+</span> <span class="n">attributeName</span> <span class="o">+</span> <span class="s">&quot; already exists for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="s">&quot; and has value &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">attributeName</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot; which is not &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">attributeName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="Entity.getAttribute"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Entity.getAttribute">[docs]</a>    <span class="k">def</span> <span class="nf">getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributeName</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">attributeName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">attributeName</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Attribute &quot;</span> <span class="o">+</span> <span class="n">attributeName</span> <span class="o">+</span> <span class="s">&quot; not present on entity &quot;</span> <span class="o">+</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s">&quot;. Present attributes are: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="Entity.hasAttribute"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Entity.hasAttribute">[docs]</a>    <span class="k">def</span> <span class="nf">hasAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributeName</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">attributeName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>

</div></div>
<div class="viewcode-block" id="printAttributes"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.printAttributes">[docs]</a><span class="k">def</span> <span class="nf">printAttributes</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="n">attributesToPrint</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span>
    <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributesToPrint</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">attribute</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributesToPrint</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="n">attribute</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="floatRange"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.floatRange">[docs]</a><span class="k">def</span> <span class="nf">floatRange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Like range but for floats...&quot;&quot;&quot;</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">val</span>
        <span class="n">val</span> <span class="o">+=</span> <span class="n">step</span>

</div>
<div class="viewcode-block" id="VariableWrapper"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.VariableWrapper">[docs]</a><span class="k">class</span> <span class="nc">VariableWrapper</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; For when I want reference-type access to an immutable&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">var</span>

</div>
<div class="viewcode-block" id="getMaxIndex"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getMaxIndex">[docs]</a><span class="k">def</span> <span class="nf">getMaxIndex</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">maxSoFar</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">maxIndex</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">maxSoFar</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">maxSoFar</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">maxIndex</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">maxIndex</span>

</div>
<div class="viewcode-block" id="splitIntegerIntoProportions"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.splitIntegerIntoProportions">[docs]</a><span class="k">def</span> <span class="nf">splitIntegerIntoProportions</span><span class="p">(</span><span class="n">integer</span><span class="p">,</span> <span class="n">proportions</span><span class="p">):</span>
    <span class="c"># just assign &#39;floor&#39; proportion*integer to each one, and give the</span>
    <span class="c"># leftovers to the largest one.</span>
    <span class="n">sizesToReturn</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">integer</span> <span class="o">*</span> <span class="n">prop</span><span class="p">)</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">proportions</span><span class="p">]</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sizesToReturn</span><span class="p">)</span>
    <span class="n">leftover</span> <span class="o">=</span> <span class="n">integer</span> <span class="o">-</span> <span class="n">total</span>
    <span class="n">sizesToReturn</span><span class="p">[</span><span class="n">getMaxIndex</span><span class="p">(</span><span class="n">proportions</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">leftover</span>
    <span class="k">return</span> <span class="n">sizesToReturn</span>

</div>
<div class="viewcode-block" id="getDateTimeString"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getDateTimeString">[docs]</a><span class="k">def</span> <span class="nf">getDateTimeString</span><span class="p">(</span><span class="n">datetimeFormat</span><span class="o">=</span><span class="s">&quot;%y-%m-</span><span class="si">%d</span><span class="s">-%H-%M&quot;</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">datetimeFormat</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sendEmails"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sendEmails">[docs]</a><span class="k">def</span> <span class="nf">sendEmails</span><span class="p">(</span><span class="n">tos</span><span class="p">,</span> <span class="n">frm</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">to</span> <span class="ow">in</span> <span class="n">tos</span><span class="p">:</span>
        <span class="n">sendEmail</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">frm</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sendEmail"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sendEmail">[docs]</a><span class="k">def</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">frm</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frm</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s">&#39;smtp.stanford.edu&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">frm</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
    <span class="n">s</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

<span class="c"># returns the string of the traceback</span>

</div>
<div class="viewcode-block" id="getErrorTraceback"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getErrorTraceback">[docs]</a><span class="k">def</span> <span class="nf">getErrorTraceback</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">traceback</span>
    <span class="k">return</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="getStackTrace"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getStackTrace">[docs]</a><span class="k">def</span> <span class="nf">getStackTrace</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">traceback</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertMutuallyExclusiveAttributes"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertMutuallyExclusiveAttributes">[docs]</a><span class="k">def</span> <span class="nf">assertMutuallyExclusiveAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">presentAndNotNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;At most one of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; should be set&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertAtLeastOneSet"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertAtLeastOneSet">[docs]</a><span class="k">def</span> <span class="nf">assertAtLeastOneSet</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">presentAndNotNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">])):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;At least one of &quot;</span> <span class="o">+</span>
                             <span class="nb">str</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; should be set&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertLessThanOrEqual"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertLessThanOrEqual">[docs]</a><span class="k">def</span> <span class="nf">assertLessThanOrEqual</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">smallerAttrName</span><span class="p">,</span> <span class="n">largerAttrName</span><span class="p">):</span>
    <span class="n">smaller</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">smallerAttrName</span><span class="p">)</span>
    <span class="n">larger</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">largerAttrName</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">smaller</span> <span class="o">&gt;</span> <span class="n">larger</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">smallerAttrName</span> <span class="o">+</span> <span class="s">&quot; should be &lt;= &quot;</span> <span class="o">+</span> <span class="n">largerAttrName</span>
                             <span class="o">+</span> <span class="s">&quot; are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">smaller</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">larger</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; respectively.&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertAllOrNone"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertAllOrNone">[docs]</a><span class="k">def</span> <span class="nf">assertAllOrNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attrNames</span><span class="p">):</span>
    <span class="n">allNone</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">presentAndNotNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrNames</span><span class="p">])</span>
    <span class="n">noneNone</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">absentOrNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrNames</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">allNone</span> <span class="ow">or</span> <span class="n">noneNone</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;Either all should be none or&quot;</span>
                             <span class="o">+</span> <span class="s">&quot; none should be none, but values are&quot;</span>
                             <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">([(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrNames</span><span class="p">]))</span>

</div>
<div class="viewcode-block" id="presentAndNotNone"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.presentAndNotNone">[docs]</a><span class="k">def</span> <span class="nf">presentAndNotNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="presentAndNotNoneOrFalse"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.presentAndNotNoneOrFalse">[docs]</a><span class="k">def</span> <span class="nf">presentAndNotNoneOrFalse</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="absentOrNone"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.absentOrNone">[docs]</a><span class="k">def</span> <span class="nf">absentOrNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">presentAndNotNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertHasAttributes"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertHasAttributes">[docs]</a><span class="k">def</span> <span class="nf">assertHasAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">explanation</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">absentOrNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="s">&quot;should be set&quot;</span><span class="p">,</span> <span class="n">explanation</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertDoesNotHaveAttributes"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertDoesNotHaveAttributes">[docs]</a><span class="k">def</span> <span class="nf">assertDoesNotHaveAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">explanation</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">presentAndNotNone</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="s">&quot;should not be set&quot;</span><span class="p">,</span> <span class="n">explanation</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sumNumpyArrays"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sumNumpyArrays">[docs]</a><span class="k">def</span> <span class="nf">sumNumpyArrays</span><span class="p">(</span><span class="n">numpyArrays</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numpyArrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpyArrays</span><span class="p">)):</span>
        <span class="n">arr</span> <span class="o">+=</span> <span class="n">numpyArrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">arr</span>

</div>
<div class="viewcode-block" id="avgNumpyArrays"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.avgNumpyArrays">[docs]</a><span class="k">def</span> <span class="nf">avgNumpyArrays</span><span class="p">(</span><span class="n">numpyArrays</span><span class="p">):</span>
    <span class="n">theSum</span> <span class="o">=</span> <span class="n">sumNumpyArrays</span><span class="p">(</span><span class="n">numpyArrays</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theSum</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numpyArrays</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="invertIndices"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.invertIndices">[docs]</a><span class="k">def</span> <span class="nf">invertIndices</span><span class="p">(</span><span class="n">selectedIndices</span><span class="p">,</span> <span class="n">fullSetOfIndices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all indices in fullSet but not in selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selectedIndicesDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selectedIndices</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fullSetOfIndices</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">selectedIndicesDict</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="invertPermutation"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.invertPermutation">[docs]</a><span class="k">def</span> <span class="nf">invertPermutation</span><span class="p">(</span><span class="n">permutation</span><span class="p">):</span>
    <span class="n">inverse</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">newIdx</span><span class="p">,</span> <span class="n">origIdx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">permutation</span><span class="p">):</span>
        <span class="n">inverse</span><span class="p">[</span><span class="n">origIdx</span><span class="p">]</span> <span class="o">=</span> <span class="n">newIdx</span>
    <span class="k">return</span> <span class="n">inverse</span>

</div>
<div class="viewcode-block" id="valToIndexMap"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.valToIndexMap">[docs]</a><span class="k">def</span> <span class="nf">valToIndexMap</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A map from a value to the index at which it occurs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="arrToDict"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.arrToDict">[docs]</a><span class="k">def</span> <span class="nf">arrToDict</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn an array into a dictionary where each value maps to &#39;1&#39;</span>
<span class="sd">        used for membership testing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="splitChromStartEnd"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.splitChromStartEnd">[docs]</a><span class="k">def</span> <span class="nf">splitChromStartEnd</span><span class="p">(</span><span class="n">chromId</span><span class="p">):</span>
    <span class="n">chrom_startEnd</span> <span class="o">=</span> <span class="n">chromId</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">chrom</span> <span class="o">=</span> <span class="n">chrom_startEnd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start_end</span> <span class="o">=</span> <span class="n">chrom_startEnd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">chrom</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_end</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_end</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

</div>
<div class="viewcode-block" id="makeChromStartEnd"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.makeChromStartEnd">[docs]</a><span class="k">def</span> <span class="nf">makeChromStartEnd</span><span class="p">(</span><span class="n">chrom</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">chrom</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="intersects"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.intersects">[docs]</a><span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="n">chromStartEnd1</span><span class="p">,</span> <span class="n">chromStartEnd2</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">chromStartEnd1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">chromStartEnd2</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#&quot;earlier&quot; is the one with the earlier start coordinate.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chromStartEnd1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">chromStartEnd2</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">earlier</span> <span class="o">=</span> <span class="n">chromStartEnd1</span>
            <span class="n">later</span> <span class="o">=</span> <span class="n">chromStartEnd2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">earlier</span> <span class="o">=</span> <span class="n">chromStartEnd2</span>
            <span class="n">later</span> <span class="o">=</span> <span class="n">chromStartEnd1</span>
        <span class="c">#&quot;intersects&quot; if starts before the later one ends, and ends after the later one</span>
        <span class="c"># starts. Note that I am assuming 0-based start and 1-based end, a la</span>
        <span class="c"># string indexing.</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">earlier</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">later</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">earlier</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">later</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="linecount"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.linecount">[docs]</a><span class="k">def</span> <span class="nf">linecount</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&#39;wc&#39;</span><span class="p">,</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="defaultTransformation"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.defaultTransformation">[docs]</a><span class="k">def</span> <span class="nf">defaultTransformation</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">fileProcessing</span> <span class="kn">as</span> <span class="nn">fp</span>
    <span class="k">return</span> <span class="n">chainFunctions</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">trimNewline</span><span class="p">,</span> <span class="n">fp</span><span class="o">.</span><span class="n">splitByTabs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ArgumentToAdd"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArgumentToAdd">[docs]</a><span class="k">class</span> <span class="nc">ArgumentToAdd</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class to append runtime arguments to a string</span>
<span class="sd">        to facilitate auto-generation of output file names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">argumentName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">argNameAndValSep</span><span class="o">=</span><span class="s">&quot;-&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argumentName</span> <span class="o">=</span> <span class="n">argumentName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argNameAndValSep</span> <span class="o">=</span> <span class="n">argNameAndValSep</span>

<div class="viewcode-block" id="ArgumentToAdd.argNamePrefix"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArgumentToAdd.argNamePrefix">[docs]</a>    <span class="k">def</span> <span class="nf">argNamePrefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">argumentName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">argumentName</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argNameAndValSep</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ArgumentToAdd.transform"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArgumentToAdd.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">])</span>
                  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="s">&quot;__len__&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">argNamePrefix</span><span class="p">()</span> <span class="o">+</span> <span class="n">string</span>
        <span class="c"># return self.argNamePrefix()+str(self.val).replace(&quot;.&quot;,&quot;p&quot;)</span>

</div></div>
<div class="viewcode-block" id="BooleanArgument"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.BooleanArgument">[docs]</a><span class="k">class</span> <span class="nc">BooleanArgument</span><span class="p">(</span><span class="n">ArgumentToAdd</span><span class="p">):</span>

<div class="viewcode-block" id="BooleanArgument.transform"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.BooleanArgument.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span>  <span class="c"># should be True if you&#39;re calling transformation</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">argumentName</span>

</div></div>
<div class="viewcode-block" id="CoreFileNameArgument"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.CoreFileNameArgument">[docs]</a><span class="k">class</span> <span class="nc">CoreFileNameArgument</span><span class="p">(</span><span class="n">ArgumentToAdd</span><span class="p">):</span>

<div class="viewcode-block" id="CoreFileNameArgument.transform"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.CoreFileNameArgument.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">fileProcessing</span> <span class="kn">as</span> <span class="nn">fp</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">argNamePrefix</span><span class="p">()</span> <span class="o">+</span> <span class="n">fp</span><span class="o">.</span><span class="n">getCoreFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="ArrArgument"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArrArgument">[docs]</a><span class="k">class</span> <span class="nc">ArrArgument</span><span class="p">(</span><span class="n">ArgumentToAdd</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">argumentName</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;+&quot;</span><span class="p">,</span> <span class="n">toStringFunc</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ArrArgument</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">argumentName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toStringFunc</span> <span class="o">=</span> <span class="n">toStringFunc</span>

<div class="viewcode-block" id="ArrArgument.transform"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArrArgument.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">argNamePrefix</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">toStringFunc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="ArrOfFileNamesArgument"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArrOfFileNamesArgument">[docs]</a><span class="k">class</span> <span class="nc">ArrOfFileNamesArgument</span><span class="p">(</span><span class="n">ArrArgument</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">argumentName</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;+&quot;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">fileProcessing</span> <span class="kn">as</span> <span class="nn">fp</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ArrOfFileNamesArgument</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">argumentName</span><span class="p">,</span>
                                                     <span class="n">sep</span><span class="p">,</span> <span class="n">toStringFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">fp</span><span class="o">.</span><span class="n">getCoreFileName</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="addArguments"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.addArguments">[docs]</a><span class="k">def</span> <span class="nf">addArguments</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">joiner</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        args is an array of ArgumentToAdd.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">arg</span><span class="o">.</span><span class="n">val</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span>
            <span class="n">arg</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="s">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">joiner</span> <span class="o">+</span> <span class="n">arg</span><span class="o">.</span><span class="n">transform</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">string</span>

</div>
<div class="viewcode-block" id="check_pid"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.check_pid">[docs]</a><span class="k">def</span> <span class="nf">check_pid</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check For the existence of a unix pid. &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="submitProcess"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.submitProcess">[docs]</a><span class="k">def</span> <span class="nf">submitProcess</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="overrides"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.overrides">[docs]</a><span class="k">def</span> <span class="nf">overrides</span><span class="p">(</span><span class="n">interface_class</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">overrider</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">__name__</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">interface_class</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">method</span>
    <span class="k">return</span> <span class="n">overrider</span>

</div>
<div class="viewcode-block" id="computeConfusionMatrix"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeConfusionMatrix">[docs]</a><span class="k">def</span> <span class="nf">computeConfusionMatrix</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">labelOrdering</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">keySet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">confusionMatrix</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="p">)):</span>
        <span class="n">valActual</span> <span class="o">=</span> <span class="n">actual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">valPrediction</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">keySet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">valActual</span><span class="p">)</span>
        <span class="n">keySet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">valPrediction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valActual</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">confusionMatrix</span><span class="p">:</span>
            <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">valPrediction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">]:</span>
            <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">][</span><span class="n">valPrediction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">][</span><span class="n">valPrediction</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keySet</span><span class="p">)</span> <span class="k">if</span> <span class="n">labelOrdering</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">labelOrdering</span>
    <span class="c">#normalise and reorder</span>
    <span class="n">reorderedConfusionMatrix</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">valActual</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valActual</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">confusionMatrix</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Why is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">valActual</span><span class="p">)</span> <span class="o">+</span>
                  <span class="s">&quot; in the predictions but not in the actual?&quot;</span><span class="p">)</span>
            <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">reorderedConfusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">valPrediction</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">valPrediction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">]:</span>
                <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">][</span><span class="n">valPrediction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">reorderedConfusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">][</span>
                <span class="n">valPrediction</span><span class="p">]</span> <span class="o">=</span> <span class="n">confusionMatrix</span><span class="p">[</span><span class="n">valActual</span><span class="p">][</span><span class="n">valPrediction</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">reorderedConfusionMatrix</span>

</div>
<div class="viewcode-block" id="normaliseByRowsAndColumns"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseByRowsAndColumns">[docs]</a><span class="k">def</span> <span class="nf">normaliseByRowsAndColumns</span><span class="p">(</span><span class="n">theMatrix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The matrix is as a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sumEachRow</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">sumEachColumn</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">theMatrix</span><span class="p">:</span>
        <span class="n">sumEachRow</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">theMatrix</span><span class="p">[</span><span class="n">row</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sumEachColumn</span><span class="p">:</span>
                <span class="n">sumEachColumn</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sumEachRow</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+=</span> <span class="n">theMatrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
            <span class="n">sumEachColumn</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">+=</span> <span class="n">theMatrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
    <span class="n">normalisedConfusionMatrix_byRow</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">theMatrix</span><span class="p">)</span>
    <span class="n">normalisedConfusionMatrix_byColumn</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">theMatrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">theMatrix</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">theMatrix</span><span class="p">[</span><span class="n">row</span><span class="p">]:</span>
            <span class="n">normalisedConfusionMatrix_byRow</span><span class="p">[</span><span class="n">row</span><span class="p">][</span>
                <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">theMatrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="n">sumEachRow</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">normalisedConfusionMatrix_byColumn</span><span class="p">[</span><span class="n">row</span><span class="p">][</span>
                <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">theMatrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="n">sumEachColumn</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">normalisedConfusionMatrix_byRow</span><span class="p">,</span> <span class="n">normalisedConfusionMatrix_byColumn</span><span class="p">,</span> <span class="n">sumEachRow</span><span class="p">,</span> <span class="n">sumEachColumn</span>

</div>
<div class="viewcode-block" id="sampleFromProbsArr"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sampleFromProbsArr">[docs]</a><span class="k">def</span> <span class="nf">sampleFromProbsArr</span><span class="p">(</span><span class="n">arrWithProbs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will return a sampled index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">randNum</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">cdfSoFar</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrWithProbs</span><span class="p">):</span>
        <span class="n">cdfSoFar</span> <span class="o">+=</span> <span class="n">prob</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cdfSoFar</span> <span class="o">&gt;=</span> <span class="n">randNum</span> <span class="ow">or</span> <span class="n">idx</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrWithProbs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>  <span class="c"># need the</span>
            <span class="c"># letterIdx==(len(row)-1) clause because of potential floating point errors</span>
            <span class="c"># that mean arrWithProbs doesn&#39;t sum to 1</span>
            <span class="k">return</span> <span class="n">idx</span>

</div>
<div class="viewcode-block" id="sampleFromDiscreteDistribution"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sampleFromDiscreteDistribution">[docs]</a><span class="k">def</span> <span class="nf">sampleFromDiscreteDistribution</span><span class="p">(</span><span class="n">discereteDistribution</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expecting an instance of DiscreteDistribution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">discereteDistribution</span><span class="o">.</span><span class="n">indexToVal</span><span class="p">[</span><span class="n">sampleFromProbsArr</span><span class="p">(</span><span class="n">discereteDistribution</span><span class="o">.</span><span class="n">freqArr</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="sampleNinstancesFromDiscreteDistribution"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sampleNinstancesFromDiscreteDistribution">[docs]</a><span class="k">def</span> <span class="nf">sampleNinstancesFromDiscreteDistribution</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">discreteDistribution</span><span class="p">):</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">toReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sampleFromDiscreteDistribution</span><span class="p">(</span><span class="n">discreteDistribution</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="getFromEnum"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getFromEnum">[docs]</a><span class="k">def</span> <span class="nf">getFromEnum</span><span class="p">(</span><span class="n">theEnum</span><span class="p">,</span> <span class="n">enumName</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>  <span class="c"># for yaml serialisation</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">theEnum</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">theEnum</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">validKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">theEnum</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;__&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s">&#39;vals&#39;</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;No &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span>
                           <span class="s">&quot; support keys for enumName are: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">validKeys</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Options"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Options">[docs]</a><span class="k">class</span> <span class="nc">Options</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="getAllPossibleSubsets"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getAllPossibleSubsets">[docs]</a><span class="k">def</span> <span class="nf">getAllPossibleSubsets</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">subsets</span> <span class="o">=</span> <span class="p">[[]]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="n">newSubsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">:</span>
            <span class="n">newSubsets</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">item</span><span class="p">]</span> <span class="o">+</span> <span class="n">subset</span><span class="p">)</span>
        <span class="n">subsets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">newSubsets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subsets</span>

</div>
<div class="viewcode-block" id="TitledMappingIterator"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMappingIterator">[docs]</a><span class="k">class</span> <span class="nc">TitledMappingIterator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over TitledArrs for the keys in titledMapping.mapping</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">titledMapping</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">titledMapping</span> <span class="o">=</span> <span class="n">titledMapping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keysIterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">titledMapping</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span>

<div class="viewcode-block" id="TitledMappingIterator.next"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMappingIterator.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nextKey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keysIterator</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">titledMapping</span><span class="o">.</span><span class="n">getTitledArrForKey</span><span class="p">(</span><span class="n">nextKey</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TitledMapping"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMapping">[docs]</a><span class="k">class</span> <span class="nc">TitledMapping</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When each key maps to an array, and each index in the array is associated with</span>
<span class="sd">            a name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">titleArr</span><span class="p">,</span> <span class="n">flagIfInconsistent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>  <span class="c"># mapping from name of a key to the values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">titleArr</span> <span class="o">=</span> <span class="n">titleArr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">titleArr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">titleArr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flagIfInconsistent</span> <span class="o">=</span> <span class="n">flagIfInconsistent</span>

<div class="viewcode-block" id="TitledMapping.keyPresenceCheck"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMapping.keyPresenceCheck">[docs]</a>    <span class="k">def</span> <span class="nf">keyPresenceCheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Throws an error if the key is absent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s">&quot;Key &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; not in mapping supported feature names are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="TitledMapping.getArrForKey"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMapping.getArrForKey">[docs]</a>    <span class="k">def</span> <span class="nf">getArrForKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyPresenceCheck</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="TitledMapping.getTitledArrForKey"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMapping.getTitledArrForKey">[docs]</a>    <span class="k">def</span> <span class="nf">getTitledArrForKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            returns an instance of util.TitledArr which has: getCol(colName) and setCol(colName)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TitledArr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">titleArr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getArrForKey</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TitledMapping.addKey"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMapping.addKey">[docs]</a>    <span class="k">def</span> <span class="nf">addKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowSize</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;arr should be of size &quot;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowSize</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; but is of size &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flagIfInconsistent</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Tired to add &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; for key &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; but &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot; already present&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>
</div>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Iterator is over instances of TitledArr!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TitledMappingIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="TitledMapping.printToFile"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledMapping.printToFile">[docs]</a>    <span class="k">def</span> <span class="nf">printToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileHandle</span><span class="p">,</span> <span class="n">includeRownames</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">fileProcessing</span> <span class="kn">as</span> <span class="nn">fp</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">writeMatrixToFile</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">titleArr</span><span class="p">,</span> <span class="p">[</span>
                             <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

</div></div>
<div class="viewcode-block" id="Titled2DMatrix"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Titled2DMatrix">[docs]</a><span class="k">class</span> <span class="nc">Titled2DMatrix</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        has a 2D matrix, rowNames and colNames arrays</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colNamesPresent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rowNamesPresent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colNames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rowNames</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Two ways to initialise either specify rowNamesPresent/colNamesPresent and</span>
<span class="sd">                add the actual rows with addRow, or specify rows/colNames/rowNames</span>
<span class="sd">                in one shot, and colNamesPresent/rowNamesPresent will be set appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">colNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">rowNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">rows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s">&quot;If colNames or rowNames is specified, rows should be specified&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">colNamesPresent</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">rowNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rowNamesPresent</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colNamesPresent</span> <span class="o">=</span> <span class="n">colNamesPresent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowNamesPresent</span> <span class="o">=</span> <span class="n">rowNamesPresent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowNames</span> <span class="o">=</span> <span class="n">rowNames</span> <span class="k">if</span> <span class="n">rowNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span>
            <span class="p">[]</span> <span class="k">if</span> <span class="n">rowNamesPresent</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colNames</span> <span class="o">=</span> <span class="n">colNames</span> <span class="k">if</span> <span class="n">colNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">(</span>
            <span class="p">[]</span> <span class="k">if</span> <span class="n">colNamesPresent</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span>

<div class="viewcode-block" id="Titled2DMatrix.setColNames"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Titled2DMatrix.setColNames">[docs]</a>    <span class="k">def</span> <span class="nf">setColNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colNames</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">colNamesPresent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colNames</span> <span class="o">=</span> <span class="n">colNames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colNames</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Titled2DMatrix.addRow"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Titled2DMatrix.addRow">[docs]</a>    <span class="k">def</span> <span class="nf">addRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">rowName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowNamesPresent</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rowName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rowName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rowNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rowName</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colNamesPresent</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colNames</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;There are &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colNames</span><span class="p">))</span> <span class="o">+</span>
                                   <span class="s">&quot; column names but only &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot; columns in this row&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Titled2DMatrix.normaliseRows"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Titled2DMatrix.normaliseRows">[docs]</a>    <span class="k">def</span> <span class="nf">normaliseRows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rowNormalise</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Titled2DMatrix.printToFile"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.Titled2DMatrix.printToFile">[docs]</a>    <span class="k">def</span> <span class="nf">printToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileHandle</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">fileProcessing</span> <span class="kn">as</span> <span class="nn">fp</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">writeMatrixToFile</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">colNames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowNames</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TitledArr"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledArr">[docs]</a><span class="k">class</span> <span class="nc">TitledArr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">colNameToIndex</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span> <span class="o">=</span> <span class="n">colNameToIndex</span>

<div class="viewcode-block" id="TitledArr.getCol"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledArr.getCol">[docs]</a>    <span class="k">def</span> <span class="nf">getCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span><span class="p">[</span><span class="n">colName</span><span class="p">]]</span>
</div>
<div class="viewcode-block" id="TitledArr.setCol"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TitledArr.setCol">[docs]</a>    <span class="k">def</span> <span class="nf">setCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colName</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">colNameToIndex</span><span class="p">[</span><span class="n">colName</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>

</div></div>
<div class="viewcode-block" id="rowNormalise"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.rowNormalise">[docs]</a><span class="k">def</span> <span class="nf">rowNormalise</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">rowSums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rowSums</span> <span class="o">=</span> <span class="n">rowSums</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span>  <span class="c"># expand for axis compatibility</span>
    <span class="k">return</span> <span class="n">matrix</span> <span class="o">/</span> <span class="n">rowSums</span>

</div>
<div class="viewcode-block" id="computeCooccurence"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeCooccurence">[docs]</a><span class="k">def</span> <span class="nf">computeCooccurence</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        matrix: rows (first dim) are examples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="n">coocc</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rowNormalise</span><span class="p">(</span><span class="n">coocc</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="swapIndices"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.swapIndices">[docs]</a><span class="k">def</span> <span class="nf">swapIndices</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

</div>
<div class="viewcode-block" id="objectFromArgsAndKwargs"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.objectFromArgsAndKwargs">[docs]</a><span class="k">def</span> <span class="nf">objectFromArgsAndKwargs</span><span class="p">(</span><span class="n">classOfObject</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">return</span> <span class="n">classOfObject</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="objectFromArgsAndKwargsFromYaml"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.objectFromArgsAndKwargsFromYaml">[docs]</a><span class="k">def</span> <span class="nf">objectFromArgsAndKwargsFromYaml</span><span class="p">(</span><span class="n">classOfObject</span><span class="p">,</span> <span class="n">yamlWithArgsAndKwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">objectFromArgsAndKwargs</span><span class="p">(</span><span class="n">classOfObject</span><span class="p">,</span> <span class="n">yamlWithArgsAndKwargs</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;args&#39;</span> <span class="ow">in</span> <span class="n">yamlWithArgsAndKwargs</span> <span class="k">else</span> <span class="p">[],</span> <span class="n">yamlWithArgsAndKwargs</span><span class="p">[</span><span class="s">&#39;kwargs&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;kwargs&#39;</span> <span class="ow">in</span> <span class="n">yamlWithArgsAndKwargs</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="arrayEquals"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.arrayEquals">[docs]</a><span class="k">def</span> <span class="nf">arrayEquals</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compares corresponding entries in arr1 and arr2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="autovivisect"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.autovivisect">[docs]</a><span class="k">def</span> <span class="nf">autovivisect</span><span class="p">(</span><span class="n">theDict</span><span class="p">,</span> <span class="n">getThingToInitialiseWith</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">theDict</span><span class="p">:</span>
            <span class="n">theDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">getThingToInitialiseWith</span><span class="p">()</span>
        <span class="n">theDict</span> <span class="o">=</span> <span class="n">theDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="setOfSeqsTo2Dimages"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.setOfSeqsTo2Dimages">[docs]</a><span class="k">def</span> <span class="nf">setOfSeqsTo2Dimages</span><span class="p">(</span><span class="n">sequences</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c"># additional index for channel</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">seqIdx</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequences</span><span class="p">):</span>
        <span class="n">seqTo2DImages_fillInArray</span><span class="p">(</span><span class="n">toReturn</span><span class="p">[</span><span class="n">seqIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sequence</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="seqTo2Dimage"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.seqTo2Dimage">[docs]</a><span class="k">def</span> <span class="nf">seqTo2Dimage</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)))</span>
    <span class="n">seqTo2DImages_fillInArray</span><span class="p">(</span><span class="n">toReturn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sequence</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="imageToSeq"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.imageToSeq">[docs]</a><span class="k">def</span> <span class="nf">imageToSeq</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">letterOrdering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">]</span>
    <span class="c"># inverts one-hot encoding</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">letterOrdering</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="c"># Letter as 1, other letters as 0</span>

</div>
<div class="viewcode-block" id="seqTo2DImages_fillInArray"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.seqTo2DImages_fillInArray">[docs]</a><span class="k">def</span> <span class="nf">seqTo2DImages_fillInArray</span><span class="p">(</span><span class="n">zerosArray</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
    <span class="c"># zerosArray should be an array of dim 4xlen(sequence), filled with zeros.</span>
    <span class="c"># will mutate zerosArray</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;a&quot;</span><span class="p">):</span>
            <span class="n">charIdx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&quot;C&quot;</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;c&quot;</span><span class="p">):</span>
            <span class="n">charIdx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&quot;G&quot;</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;g&quot;</span><span class="p">):</span>
            <span class="n">charIdx</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&quot;T&quot;</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;t&quot;</span><span class="p">):</span>
            <span class="n">charIdx</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">char</span> <span class="o">==</span> <span class="s">&quot;N&quot;</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&quot;n&quot;</span><span class="p">):</span>
            <span class="k">continue</span>  <span class="c"># leave that pos as all 0&#39;s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Unsupported character: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">char</span><span class="p">))</span>
        <span class="n">zerosArray</span><span class="p">[</span><span class="n">charIdx</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># Letter as 3, other letters as -1</span>
<span class="c"># def seqTo2DImages_fillInArray(zerosArray,sequence):</span>
<span class="c">#     #zerosArray should be an array of dim 4xlen(sequence), filled with zeros.</span>
<span class="c">#     #will mutate zerosArray</span>
<span class="c">#     for (i,char) in enumerate(sequence):</span>
<span class="c">#         if (char==&quot;A&quot; or char==&quot;a&quot;):</span>
<span class="c">#             charIdx = 0</span>
<span class="c">#         elif (char==&quot;C&quot; or char==&quot;c&quot;):</span>
<span class="c">#             charIdx = 1</span>
<span class="c">#         elif (char==&quot;G&quot; or char==&quot;g&quot;):</span>
<span class="c">#             charIdx = 2</span>
<span class="c">#         elif (char==&quot;T&quot; or char==&quot;t&quot;):</span>
<span class="c">#             charIdx = 3</span>
<span class="c">#         elif (char==&quot;N&quot; or char==&quot;n&quot;):</span>
<span class="c">#             continue #leave that pos as all 0&#39;s</span>
<span class="c">#         else:</span>
<span class="c">#             raise RuntimeError(&quot;Unsupported character: &quot;+str(char))</span>
<span class="c">#         zerosArray[charIdx,i]=1.73</span>
<span class="c">#         negIdx = [el for el in range(4) if el!=charIdx]</span>
<span class="c">#         zerosArray[negIdx,i]=-0.577</span>

</div>
<div class="viewcode-block" id="doPCAonFile"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.doPCAonFile">[docs]</a><span class="k">def</span> <span class="nf">doPCAonFile</span><span class="p">(</span><span class="n">theFile</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">sklearn.decomposition</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read2DMatrix</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">getFileHandle</span><span class="p">(</span>
        <span class="n">theFile</span><span class="p">),</span> <span class="n">colNamesPresent</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rowNamesPresent</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">contentStartIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">decomposition</span><span class="o">.</span><span class="n">PCA</span><span class="p">()</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pca</span>

</div>
<div class="viewcode-block" id="auPRC"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.auPRC">[docs]</a><span class="k">def</span> <span class="nf">auPRC</span><span class="p">(</span><span class="n">trueY</span><span class="p">,</span> <span class="n">predictedYscores</span><span class="p">,</span> <span class="n">plotFileName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">average_precision_score</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">trueY</span><span class="p">,</span> <span class="n">predictedYscores</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotFileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span>
            <span class="n">trueY</span><span class="p">,</span> <span class="n">predictedYscores</span><span class="p">)</span>
        <span class="n">plotPRC</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">toReturn</span><span class="p">,</span> <span class="n">plotFileName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="plotPRC"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.plotPRC">[docs]</a><span class="k">def</span> <span class="nf">plotPRC</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">plotFileName</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Precision-Recall curve&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Precision-Recall: AUC={0:0.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auc</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;lower left&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotFileName</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="assertAttributesHaveTheSameLengths"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertAttributesHaveTheSameLengths">[docs]</a><span class="k">def</span> <span class="nf">assertAttributesHaveTheSameLengths</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">attributeNames</span><span class="p">):</span>
    <span class="n">lens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">lens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lens</span><span class="p">])):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;all of the following attributes should have the same length: &quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attributeNames</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span>
                         <span class="s">&quot;Instead, they have lengths: &quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lens</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="splitIgnoringQuotes"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.splitIgnoringQuotes">[docs]</a><span class="k">def</span> <span class="nf">splitIgnoringQuotes</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charToSplitOn</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        will split on charToSplitOn, ignoring things that are in quotes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>  <span class="c"># strip padding whitespace on left</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">thisWord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lastSplitPos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">inQuote</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">inQuote</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&#39;&quot;&#39;</span><span class="p">:</span>
                <span class="n">inQuote</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisWord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&#39;&quot;&#39;</span><span class="p">:</span>
                <span class="n">inQuote</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">charToSplitOn</span><span class="p">:</span>
                    <span class="n">toReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisWord</span><span class="p">))</span>
                    <span class="n">thisWord</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thisWord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisWord</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">toReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">thisWord</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Parsed arguments:&quot;</span><span class="p">,</span> <span class="n">toReturn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">toReturn</span>

<span class="c"># for those rare cases where</span>
<span class="c"># you want to have some keyword</span>
<span class="c"># like UNDEF</span>

</div>
<div class="viewcode-block" id="getSingleton"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getSingleton">[docs]</a><span class="k">def</span> <span class="nf">getSingleton</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">__Singleton</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">__Singleton</span><span class="p">()</span>
</div>
<span class="n">UNDEF</span> <span class="o">=</span> <span class="n">getSingleton</span><span class="p">(</span><span class="s">&quot;UNDEF&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="throwErrorIfUnequalSets"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.throwErrorIfUnequalSets">[docs]</a><span class="k">def</span> <span class="nf">throwErrorIfUnequalSets</span><span class="p">(</span><span class="n">given</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="n">givenSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">given</span><span class="p">)</span>
    <span class="n">expectedSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
    <span class="n">inGivenButNotExpected</span> <span class="o">=</span> <span class="n">givenSet</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">expectedSet</span><span class="p">)</span>
    <span class="n">inExpectedButNotGiven</span> <span class="o">=</span> <span class="n">expectedSet</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">givenSet</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inGivenButNotExpected</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s">&quot;The following were given but not expected: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inGivenButNotExpected</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inExpectedButNotGiven</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s">&quot;The following were expected but not given: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inExpectedButNotGiven</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="formattedJsonDump"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.formattedJsonDump">[docs]</a><span class="k">def</span> <span class="nf">formattedJsonDump</span><span class="p">(</span><span class="n">jsonData</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonData</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">))</span>

<span class="c"># TODO: add unit test</span>

</div>
<div class="viewcode-block" id="roundToNearest"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.roundToNearest">[docs]</a><span class="k">def</span> <span class="nf">roundToNearest</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">nearest</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nearest</span><span class="p">))</span> <span class="o">*</span> <span class="n">nearest</span>

</div>
<div class="viewcode-block" id="sampleFromRangeWithStepSize"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sampleFromRangeWithStepSize">[docs]</a><span class="k">def</span> <span class="nf">sampleFromRangeWithStepSize</span><span class="p">(</span><span class="n">minVal</span><span class="p">,</span> <span class="n">maxVal</span><span class="p">,</span> <span class="n">stepSize</span><span class="p">,</span> <span class="n">cast</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cast can be just max-min</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">maxVal</span> <span class="o">&gt;=</span> <span class="n">minVal</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">roundToNearest</span><span class="p">(</span>
        <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxVal</span> <span class="o">-</span> <span class="n">minVal</span><span class="p">))</span> <span class="o">+</span> <span class="n">minVal</span><span class="p">,</span> <span class="n">stepSize</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">toReturn</span> <span class="o">&gt;=</span> <span class="n">minVal</span>
    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">toReturn</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TeeOutputStreams"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TeeOutputStreams">[docs]</a><span class="k">class</span> <span class="nc">TeeOutputStreams</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        for piping to several output streams</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">streams</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span> <span class="o">=</span> <span class="n">streams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="TeeOutputStreams.close"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TeeOutputStreams.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="TeeOutputStreams.write"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TeeOutputStreams.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TeeOutputStreams.flush"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TeeOutputStreams.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TeeOutputStreams.writelines"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TeeOutputStreams.writelines">[docs]</a>    <span class="k">def</span> <span class="nf">writelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TeeOutputStreams.writeable"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.TeeOutputStreams.writeable">[docs]</a>    <span class="k">def</span> <span class="nf">writeable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s">&quot;__del__&quot;</span><span class="p">):</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">__del__</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="redirectStdoutToString"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.redirectStdoutToString">[docs]</a><span class="k">def</span> <span class="nf">redirectStdoutToString</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">emailErrorFunc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="c"># takes a function, and returns a wrapper which redirects</span>
    <span class="c"># stdout to something else for that function</span>
    <span class="c">#(the function must execute in a thread)</span>

    <span class="k">def</span> <span class="nf">wrapperFunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">old_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">old_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">stringIO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">teeStdout</span> <span class="o">=</span> <span class="n">TeeOutputStreams</span><span class="p">(</span><span class="n">stringIO</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">teeStderr</span> <span class="o">=</span> <span class="n">TeeOutputStreams</span><span class="p">(</span><span class="n">stringIO</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">teeStdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">teeStderr</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">old_stderr</span>
            <span class="n">traceback</span> <span class="o">=</span> <span class="n">getErrorTraceback</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">traceback</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">traceback</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">emailErrorFunc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">emailErrorFunc</span><span class="p">(</span><span class="n">traceback</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">old_stderr</span>
            <span class="n">stdoutContents</span> <span class="o">=</span> <span class="n">stringIO</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">stdoutContents</span>
    <span class="k">return</span> <span class="n">wrapperFunc</span>

</div>
<div class="viewcode-block" id="doesNotWorkForMultithreading_redirectStdout"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.doesNotWorkForMultithreading_redirectStdout">[docs]</a><span class="k">def</span> <span class="nf">doesNotWorkForMultithreading_redirectStdout</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">redirectedStdout</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="c"># takes a function, and returns a wrapper which redirects</span>
    <span class="c"># stdout to something else for that function</span>
    <span class="c">#(the function must execute in a thread)</span>

    <span class="k">def</span> <span class="nf">wrapperFunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">old_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">redirectedStdout</span>
        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_stdout</span>
</div>
<span class="n">dict2str_joiner</span> <span class="o">=</span> <span class="s">&quot;: &quot;</span>
<span class="c"># Can also be a dictionary with iterables as values</span>


<div class="viewcode-block" id="dict2str"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.dict2str">[docs]</a><span class="k">def</span> <span class="nf">dict2str</span><span class="p">(</span><span class="n">theDict</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">toJoinWithSeparator</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">theDict</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">theDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="s">&quot;numpy.__name__&quot;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
                <span class="n">stringifiedVal</span> <span class="o">=</span> <span class="s">&quot;{&quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;&quot;{0}&quot;: [{1}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subkey</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ely</span><span class="p">)</span> <span class="k">for</span> <span class="n">ely</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[</span><span class="n">subkey</span><span class="p">]]))</span> <span class="k">for</span> <span class="n">subkey</span> <span class="ow">in</span> <span class="n">val</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;}&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stringifiedVal</span> <span class="o">=</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stringifiedVal</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">toJoinWithSeparator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="n">dict2str_joiner</span> <span class="o">+</span> <span class="n">stringifiedVal</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">toJoinWithSeparator</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="getIntervals"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getIntervals">[docs]</a><span class="k">def</span> <span class="nf">getIntervals</span><span class="p">(</span><span class="n">minVal</span><span class="p">,</span> <span class="n">numSteps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">intervalsToReturn</span> <span class="o">=</span> <span class="p">[</span><span class="n">minVal</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSteps</span><span class="p">):</span>
        <span class="n">intervalsToReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getNthInterval</span><span class="p">(</span>
            <span class="n">minVal</span><span class="o">=</span><span class="n">minVal</span><span class="p">,</span> <span class="n">numSteps</span><span class="o">=</span><span class="n">numSteps</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">intervalsToReturn</span>

</div>
<div class="viewcode-block" id="sampleFromNumSteps"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sampleFromNumSteps">[docs]</a><span class="k">def</span> <span class="nf">sampleFromNumSteps</span><span class="p">(</span><span class="n">numSteps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">randomIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">numSteps</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">getNthInterval</span><span class="p">(</span><span class="n">numSteps</span><span class="o">=</span><span class="n">numSteps</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">randomIndex</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="getNthInterval"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getNthInterval">[docs]</a><span class="k">def</span> <span class="nf">getNthInterval</span><span class="p">(</span><span class="n">minVal</span><span class="p">,</span> <span class="n">maxVal</span><span class="p">,</span> <span class="n">numSteps</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">logarithmic</span><span class="p">,</span> <span class="n">roundTo</span><span class="p">,</span> <span class="n">cast</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        logarithmic: boolean indicating if want log numSteps vs linear</span>
<span class="sd">        roundTo: can be set to None for no rounding</span>
<span class="sd">        cast: can be set to just lambda x: x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">maxVal</span> <span class="o">&gt;=</span> <span class="n">minVal</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">maxVal</span> <span class="o">-</span> <span class="n">minVal</span>
    <span class="c"># assume n &gt; 0 here on:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">logarithmic</span><span class="p">):</span>
        <span class="n">scalingRatio</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">/</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">scalingRatio</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">numSteps</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stepSize</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numSteps</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">stepSize</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">coreVal</span> <span class="o">=</span> <span class="n">minVal</span> <span class="o">+</span> <span class="n">delta</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">roundTo</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">coreVal</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxVal</span><span class="p">,</span> <span class="n">roundToNearest</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">minVal</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">nearest</span><span class="o">=</span><span class="n">roundTo</span><span class="p">)),</span> <span class="n">minVal</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="randomlySampleFromArr"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.randomlySampleFromArr">[docs]</a><span class="k">def</span> <span class="nf">randomlySampleFromArr</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))]</span>

</div>
<div class="viewcode-block" id="ArgParseArgument"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArgParseArgument">[docs]</a><span class="k">class</span> <span class="nc">ArgParseArgument</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argumentName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argumentName</span> <span class="o">=</span> <span class="n">argumentName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

<div class="viewcode-block" id="ArgParseArgument.addToParser"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.ArgParseArgument.addToParser">[docs]</a>    <span class="k">def</span> <span class="nf">addToParser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">argumentName</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="assertIsType"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertIsType">[docs]</a><span class="k">def</span> <span class="nf">assertIsType</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">theClass</span><span class="p">,</span> <span class="n">instanceVarName</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">theClass</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">instanceVarName</span> <span class="o">+</span> <span class="s">&quot; should be an instance of &quot;</span>
                           <span class="o">+</span> <span class="n">theClass</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot; but is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">__class__</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="augmentArgparseKwargsHelpWithDefault"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.augmentArgparseKwargsHelpWithDefault">[docs]</a><span class="k">def</span> <span class="nf">augmentArgparseKwargsHelpWithDefault</span><span class="p">(</span><span class="o">**</span><span class="n">argParseKwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&#39;default&#39;</span> <span class="ow">in</span> <span class="n">argParseKwargs</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">argParseKwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;help&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">argParseKwargs</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="n">argParseKwargs</span><span class="p">[</span><span class="s">&#39;help&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">help</span> <span class="o">+</span> <span class="s">&quot;default &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="n">argParseKwargs</span><span class="p">[</span><span class="s">&#39;help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">help</span>
    <span class="k">return</span> <span class="n">argParseKwargs</span>

</div>
<div class="viewcode-block" id="assertArrayElementsEqual"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.assertArrayElementsEqual">[docs]</a><span class="k">def</span> <span class="nf">assertArrayElementsEqual</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="n">sumAbsDiff</span> <span class="o">=</span> <span class="n">sumAbsDifferences</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sumAbsDifferences</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Arrays are not equal&quot;</span>
                           <span class="s">&quot; sum of abs differences is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sumAbsDiff</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="sumAbsDifferences"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sumAbsDifferences">[docs]</a><span class="k">def</span> <span class="nf">sumAbsDifferences</span><span class="p">(</span><span class="n">arr1</span><span class="p">,</span> <span class="n">arr2</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr1</span> <span class="o">-</span> <span class="n">arr2</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="yamlToArgsString"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.yamlToArgsString">[docs]</a><span class="k">def</span> <span class="nf">yamlToArgsString</span><span class="p">(</span><span class="n">yamlString</span><span class="p">,</span> <span class="n">subDictEnclosingChars</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
    <span class="k">return</span> <span class="n">formatDictAsArgsString</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">yamlString</span><span class="p">),</span> <span class="n">subDictEnclosingChars</span><span class="o">=</span><span class="n">subDictEnclosingChars</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="formatDictAsArgsString"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.formatDictAsArgsString">[docs]</a><span class="k">def</span> <span class="nf">formatDictAsArgsString</span><span class="p">(</span><span class="n">theDict</span><span class="p">,</span> <span class="n">subDictEnclosingChars</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">theDict</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">theDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c"># assuming it&#39;s a flag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;--&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subDictEnclosingChars</span>
                            <span class="o">+</span> <span class="s">&quot; &quot;</span>
                            <span class="o">+</span> <span class="n">formatDictAsArgsString</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">subDictEnclosingChars</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">subDictEnclosingChars</span><span class="p">)</span>
                            <span class="o">+</span> <span class="n">subDictEnclosingChars</span>
                            <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s">&quot;Not sure how to handle value of type &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="getRandomString"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getRandomString">[docs]</a><span class="k">def</span> <span class="nf">getRandomString</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">string</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="readMultilineRawInput"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.readMultilineRawInput">[docs]</a><span class="k">def</span> <span class="nf">readMultilineRawInput</span><span class="p">(</span><span class="n">prompt</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">input</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="n">sentinel</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>  <span class="c"># ends when this string is seen</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">toReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">toReturn</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="reverse_enumerate"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.reverse_enumerate">[docs]</a><span class="k">def</span> <span class="nf">reverse_enumerate</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">))):</span>
        <span class="k">yield</span> <span class="n">index</span><span class="p">,</span> <span class="n">aList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="enumerate_skipFirst"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.enumerate_skipFirst">[docs]</a><span class="k">def</span> <span class="nf">enumerate_skipFirst</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">)):</span>
        <span class="k">yield</span> <span class="n">index</span><span class="p">,</span> <span class="n">aList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="iter_skipFirst"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.iter_skipFirst">[docs]</a><span class="k">def</span> <span class="nf">iter_skipFirst</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">)):</span>
        <span class="k">yield</span> <span class="n">aList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">index</span><span class="p">,</span> <span class="n">aList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="computeRunningWindowSum"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowSum">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowSum</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c"># returns an array s.t. element at idx i</span>
    <span class="c"># represents sum from i:i+windowSize</span>
    <span class="n">runningSum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
        <span class="n">runningSum</span> <span class="o">+=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">windowSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">toReturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runningSum</span><span class="p">)</span>
            <span class="n">runningSum</span> <span class="o">-=</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="p">(</span><span class="n">windowSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="computeRunningWindowOp"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowOp">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowOp</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">toReturn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="n">windowSize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,))</span>
    <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">windowSize</span><span class="p">):</span>
        <span class="n">numberOfWindowsThatFit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">windowSize</span><span class="p">)</span>
        <span class="n">endIndex</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">windowSize</span> <span class="o">*</span> <span class="n">numberOfWindowsThatFit</span>
        <span class="n">reshapedArr</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">endIndex</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">))</span>
        <span class="n">valsForThisOffset</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">reshapedArr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">toReturn</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">endIndex</span><span class="p">:</span><span class="n">windowSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">valsForThisOffset</span>
    <span class="k">return</span> <span class="n">toReturn</span>

</div>
<div class="viewcode-block" id="computeRunningWindowMax"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowMax">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowMax</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="n">computeRunningWindowOp</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="computeRunningWindowTwoNorm_2d"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowTwoNorm_2d">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowTwoNorm_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">computeRunningWindowSum</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="computeRunningWindowMaxActivation_2d"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowMaxActivation_2d">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowMaxActivation_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">computeRunningWindowSum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">windowSize</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="computeRunningWindowSum_2d"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowSum_2d">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowSum_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">computeRunningWindowSum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">windowSize</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="crossCorrelation_2d"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.crossCorrelation_2d">[docs]</a><span class="k">def</span> <span class="nf">crossCorrelation_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">reversedSmaller</span> <span class="o">=</span> <span class="n">smallerArr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">crossCorrelations</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">reversedSmaller</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;valid&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crossCorrelations</span>

</div>
<div class="viewcode-block" id="runningWindowOneOver"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.runningWindowOneOver">[docs]</a><span class="k">def</span> <span class="nf">runningWindowOneOver</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">runningWindowVals</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)</span>
    <span class="n">runningWindowVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">fix_invalid</span><span class="p">(</span><span class="n">runningWindowVals</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">toMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">runningWindowVals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">runningWindowVals</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">toMask</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="computeRunningWindowOneOverMaxActivation_2d"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowOneOverMaxActivation_2d">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowOneOverMaxActivation_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="n">runningWindowOneOver</span><span class="p">(</span><span class="n">computeRunningWindowMaxActivation_2d</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="computeRunningWindowOneOverTwoNorm_2d"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.computeRunningWindowOneOverTwoNorm_2d">[docs]</a><span class="k">def</span> <span class="nf">computeRunningWindowOneOverTwoNorm_2d</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="n">runningWindowOneOver</span><span class="p">(</span><span class="n">computeRunningWindowTwoNorm_2d</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">smallerArr</span><span class="p">,</span> <span class="n">windowSize</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IterableFromDict"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.IterableFromDict">[docs]</a><span class="k">class</span> <span class="nc">IterableFromDict</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theDict</span><span class="p">,</span> <span class="n">defaultVal</span><span class="p">,</span> <span class="n">totalLen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span> <span class="o">=</span> <span class="n">theDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultVal</span> <span class="o">=</span> <span class="n">defaultVal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalLen</span> <span class="o">=</span> <span class="n">totalLen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<div class="viewcode-block" id="IterableFromDict.next"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.IterableFromDict.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalLen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultVal</span>
</div>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

</div>
<div class="viewcode-block" id="SparseArrFromDict"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.SparseArrFromDict">[docs]</a><span class="k">class</span> <span class="nc">SparseArrFromDict</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theDict</span><span class="p">,</span> <span class="n">defaultVal</span><span class="p">,</span> <span class="n">totalLen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span> <span class="o">=</span> <span class="n">theDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultVal</span> <span class="o">=</span> <span class="n">defaultVal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalLen</span> <span class="o">=</span> <span class="n">totalLen</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IterableFromDict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultVal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalLen</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s">&quot;only int indexing allowed&quot;</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalLen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s">&quot;Got index &quot;</span>
                             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                             <span class="o">+</span> <span class="s">&quot; but max is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalLen</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">theDict</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultVal</span>

</div>
<div class="viewcode-block" id="getBest"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.getBest">[docs]</a><span class="k">def</span> <span class="nf">getBest</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">getterFunc</span><span class="p">,</span> <span class="n">takeMax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will return a tuple of the</span>
<span class="sd">            index and the value of the best</span>
<span class="sd">            as extracted by getterFunc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">theBest</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">theBestOriginalVal</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">originalVal</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">getterFunc</span><span class="p">(</span><span class="n">originalVal</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">theBest</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">theBest</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">theBestOriginalVal</span> <span class="o">=</span> <span class="n">originalVal</span>
        <span class="n">isBetter</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">takeMax</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">theBest</span><span class="p">:</span>
                <span class="n">isBetter</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">theBest</span><span class="p">:</span>
                <span class="n">isBetter</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isBetter</span><span class="p">):</span>
            <span class="n">theBestOriginalVal</span> <span class="o">=</span> <span class="n">originalVal</span>
            <span class="n">theBest</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">theBestOriginalVal</span><span class="p">,</span> <span class="n">theBest</span>

</div>
<div class="viewcode-block" id="multiprocessing_map_printProgress"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.multiprocessing_map_printProgress">[docs]</a><span class="k">def</span> <span class="nf">multiprocessing_map_printProgress</span><span class="p">(</span><span class="n">secondsBetweenUpdates</span><span class="p">,</span> <span class="n">numThreads</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">numThreads</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map_async</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="n">iterable</span><span class="p">)</span>
    <span class="n">totalTasks</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">_number_left</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">ready</span><span class="p">()):</span>
            <span class="k">break</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">_number_left</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">secondsBetweenUpdates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="fracToRainbowColour"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.fracToRainbowColour">[docs]</a><span class="k">def</span> <span class="nf">fracToRainbowColour</span><span class="p">(</span><span class="n">frac</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        frac is a number from 0 to 1. Map to</span>
<span class="sd">            a 3-tuple representing a rainbow colour.</span>
<span class="sd">        1 -&gt; (0, 1, 0) #green</span>
<span class="sd">        0.75 -&gt; (1, 0, 1) #yellow</span>
<span class="sd">        0.5 -&gt; (1, 0, 0) #red</span>
<span class="sd">        0.25 -&gt; (1, 1, 0) #violet</span>
<span class="sd">        0 -&gt; (0, 0, 1) #blue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unscaledTuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">frac</span><span class="p">)</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">frac</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
                     <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">frac</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">frac</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)))</span>
    <span class="c"># scale so max is 1</span>
    <span class="n">theMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">unscaledTuple</span><span class="p">)</span>
    <span class="n">scaledTuple</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">theMax</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unscaledTuple</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">scaledTuple</span>

</div>
<div class="viewcode-block" id="sortByLabels"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.sortByLabels">[docs]</a><span class="k">def</span> <span class="nf">sortByLabels</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        intended use case: sorting by cluster labels for</span>
<span class="sd">            plotting a heatmap</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">labels</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])]</span>

</div>
<div class="viewcode-block" id="printRegionIds"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.printRegionIds">[docs]</a><span class="k">def</span> <span class="nf">printRegionIds</span><span class="p">(</span><span class="n">regionIds</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">labelFilter</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">,</span> <span class="n">idTransformation</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">fileProcessing</span> <span class="kn">as</span> <span class="nn">fp</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        intended use case: printing out the regions that corresponds</span>
<span class="sd">            to particular cluster labels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rowsToPrint</span> <span class="o">=</span> <span class="p">[</span><span class="n">idTransformation</span><span class="p">(</span><span class="n">regionIds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span>
                   <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regionIds</span><span class="p">))</span> <span class="k">if</span> <span class="n">labelFilter</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">writeRowsToFile</span><span class="p">(</span><span class="n">rowsToPrint</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="printCoordinatesForLabelSubsets"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.printCoordinatesForLabelSubsets">[docs]</a><span class="k">def</span> <span class="nf">printCoordinatesForLabelSubsets</span><span class="p">(</span><span class="n">regionIds</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">labelSetsToFilterFor</span><span class="p">,</span> <span class="n">outputFilePrefix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assumes regionIds of the form chr:start-end</span>
<span class="sd">        labelSetsToFilter as an iterable of iterables of the</span>
<span class="sd">            label you want to subset.</span>
<span class="sd">            Will be incorportated into the filename</span>
<span class="sd">        outputFile will be outputFilePrefix+&quot;_&quot;</span>
<span class="sd">                            +&quot;-&quot;.join(str(x) for x in labelsToFilter)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idTransformation</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">splitChromStartEnd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                                  <span class="o">+</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">labelsToFilterFor</span> <span class="ow">in</span> <span class="n">labelSetsToFilterFor</span><span class="p">:</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="p">(</span><span class="n">outputFilePrefix</span> <span class="o">+</span> <span class="s">&quot;_labels-&quot;</span><span class="p">)</span>\
            <span class="o">+</span> <span class="p">(</span><span class="s">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">labelsToFilterFor</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span>
        <span class="n">setOfLabelsToFilterFor</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">labelsToFilterFor</span><span class="p">)</span>
        <span class="n">printRegionIds</span><span class="p">(</span><span class="n">regionIds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">labelFilter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">x</span> <span class="ow">in</span> <span class="n">setOfLabelsToFilterFor</span><span class="p">),</span> <span class="n">outputFile</span><span class="o">=</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">idTransformation</span><span class="o">=</span><span class="n">idTransformation</span><span class="p">)</span>
    <span class="n">outputFile</span> <span class="o">=</span> <span class="p">(</span><span class="n">outputFilePrefix</span> <span class="o">+</span> <span class="s">&quot;_all.txt&quot;</span><span class="p">)</span>
    <span class="n">printRegionIds</span><span class="p">(</span><span class="n">regionIds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">labelFilter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                   <span class="n">outputFile</span><span class="o">=</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">idTransformation</span><span class="o">=</span><span class="n">idTransformation</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="normaliseEntriesByMeanAndSdev"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseEntriesByMeanAndSdev">[docs]</a><span class="k">def</span> <span class="nf">normaliseEntriesByMeanAndSdev</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c">#assert np.mean(arr)==0 or np.mean(arr) &lt; 10**(-7), str(np.mean(arr))+&#39; If you are using sequence as input, be sure to mean normalize&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="normaliseEntriesByMeanAndTwoNorm"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseEntriesByMeanAndTwoNorm">[docs]</a><span class="k">def</span> <span class="nf">normaliseEntriesByMeanAndTwoNorm</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c">#assert np.mean(arr)==0 or np.mean(arr) &lt; 10**(-7), str(np.mean(arr))+&#39; If you are using sequence as input, be sure to mean normalize else comment out this line&#39;</span>
    <span class="n">theMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">theMean</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">theMean</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="normaliseEntriesByTwoNorm"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseEntriesByTwoNorm">[docs]</a><span class="k">def</span> <span class="nf">normaliseEntriesByTwoNorm</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="n">arr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">))))</span>

</div>
<div class="viewcode-block" id="normaliseEntriesBySdev"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseEntriesBySdev">[docs]</a><span class="k">def</span> <span class="nf">normaliseEntriesBySdev</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="normaliseRowsByMeanAndSdev_firstFourSeq"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseRowsByMeanAndSdev_firstFourSeq">[docs]</a><span class="k">def</span> <span class="nf">normaliseRowsByMeanAndSdev_firstFourSeq</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="c"># normalises each row by mean and sdev but</span>
    <span class="c"># treats the first four as one track type</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">])]</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">sdevs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="mi">4</span><span class="p">])]</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">means</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sdevs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">sdevs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sdevs</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sdevs</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="normaliseRowsByMeanAndSdev"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseRowsByMeanAndSdev">[docs]</a><span class="k">def</span> <span class="nf">normaliseRowsByMeanAndSdev</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">meanRows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sdevRows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">meanRows</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">sdevRows</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="normaliseEntriesZeroToOne"><a class="viewcode-back" href="../../../dragonn.synthetic.util.html#dragonn.synthetic.util.normaliseEntriesZeroToOne">[docs]</a><span class="k">def</span> <span class="nf">normaliseEntriesZeroToOne</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">minArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">minArr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="n">minArr</span><span class="p">)</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Johnny Israeli, Michael Wainberg, Avanti Shrikumar.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>